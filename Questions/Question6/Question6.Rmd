---
title: "Paged HTML Document"
author: "NF Katzke"
date: "November 2021"
# date: "`r Sys.Date()`"
bibliography: Tex/ref.bib       # Do not edit: Keep this naming convention and location.
output:
  pagedown::html_paged:
    # template: wp_paged.html
    # css: ['wp.css', 'wp-fonts.css', 'wp-page.css']
    css: ["Template/default-fonts-Texevier.css", "Template/default-page-Texevier.css", "Template/default-Texevier.css"]
    csl: Template/harvard-stellenbosch-university.csl # referencing format used.
    template: ["Template/paged-Texevier.html"]

    toc: true
    # change to true for a self-contained document, but it'll be a litte slower for Pandoc to render
    self_contained: TRUE
abstract: |
    This is an abstract. Much can be written here. Uncomment this line to go without an abstract.
    Abstracts have no spaces, but can have bullets.

    Bullets can be created as follows

    + You can add bullets, but do not add colons please.

    + Line breaks are also not permitted.

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)
pacman::p_load(modelsummary, gt, knitr, kableExtra, tidyverse)
```

\newpage

# Introduction {-}

This template has been adapted from pagedown::html_paged and is intended to help you simply create HTML that has a readable (pdf) feel to it.

References are to be made as follows: [@fama1997] and @grinold2000 Such authors could also be referenced in brackets [@grinold2000] and together [@fama1997 \& @grinold2000]. Source the reference code from scholar.google.com by clicking on ``cite'' below article name. Then select BibTeX at the bottom of the Cite window, and proceed to copy and paste this code into your ref.bib file, located in the directory's Tex folder. Open this file in Rstudio for ease of management, else open it in your preferred Tex environment. Add and manage your article details here for simplicity - once saved, it will self-adjust in your paper.

> I suggest renaming the top line after \@article, as done in the template ref.bib file, to something more intuitive for you to remember. Do not change the rest of the code. Also, be mindful of the fact that bib references from google scholar may at times be incorrect. Reference Latex forums for correct bibtex notation.

Writing in Rmarkdown is surprizingly easy - see [this website](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf) cheatsheet for a summary on writing Rmd writing tips.

# Data  {-}

Notice how I used the curly brackets and dash to remove the numbering of the data section.

Discussion of data should be thorough with a table of statistics and ideally a figure.

In your tempalte folder, you will find a Data and a Code folder. In order to keep your data files neat, store all of them in your Data folder. Also, I strongly suggest keeping this Rmd file for writing and executing commands, not writing out long pieces of data-wrangling. In the example below, I simply create a ggplot template for scatter plot consistency. I suggest keeping all your data in a data folder.

<!-- The following is a code chunk. It must have its own unique name (after the r), or no name. After the comma follows commands for R which are self-explanatory. By default, the code and messages will not be printed in your pdf, just the output: -->

```{r }
library(tbl2xts)
library(xts)
MAA <- read_rds("/Users/x/Downloads/28736907_Fin_Metrics/Questions/Question6/data/MAA.rds")
msci <- read_rds("/Users/x/Downloads/28736907_Fin_Metrics/Questions/Question6/data/msci.rds") %>%
filter(Name %in% c("MSCI_ACWI", "MSCI_USA", "MSCI_RE", "MSCI_Jap"))

```


```{r}
# Load libraries
library(tidyverse)
library(tbl2xts)

merged <- process_data("2011-01-01", "2023-01-01", msci, MAA)

returns_data <- calculate_returns(merged)

Rebalance_Days <- reb_days(returns_data)


rebalance_col <- reb_data(returns_data, Rebalance_Days)

Capped_df <- rebalance_col %>%
  group_split(RebalanceTime) %>%
  map_df(~Cap_With_Groups(., W_Cap = 0.4, Equity_Cap = 0.6, Bond_Cap = 0.25)) %>%
  select(-RebalanceTime)


wts <- Capped_df %>%
  tbl_xts(cols_to_xts = weight, spread_by = Name)

rts <- returns_data %>%
  filter(Name %in% unique(Capped_df$Name)) %>%
  tbl_xts(cols_to_xts = Return, spread_by = Name)


wts[is.na(wts)] <- 0
rts[is.na(rts)] <- 0

plot_safe_returns(rts, wts)

```


# References {-}

<div id="refs"></div>


# Appendix {-}

## Appendix A {-}

Some appendix information here

## Appendix B {-}



